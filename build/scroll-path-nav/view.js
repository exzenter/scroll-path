!function(){"use strict";document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".scrollpath-nav").forEach(e=>{new t(e)})});class t{constructor(t){this.container=t,this.visibleClass="scrollpath-nav__item--visible",this.navItems=[],this.navPath=null,this.observer=null,this.init()}init(){const t=this.findHeadings();0!==t.length?(this.ensureHeadingIds(t),this.buildNavigation(t),this.setupSvgPath(),this.drawPath(),this.setupObserver(t),window.addEventListener("resize",this.debounce(()=>this.drawPath(),100))):this.container.innerHTML='<p class="scrollpath-nav__empty">No headings found on this page.</p>'}findHeadings(){return[...document.querySelectorAll("h2, h3, h4")].filter(t=>!t.closest(".scrollpath-nav")&&!t.closest(".scrollpath-nav-editor"))}ensureHeadingIds(t){const e=new Set;t.forEach((t,s)=>{if(!t.id){let s=t.textContent.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");s||(s="section");let a=s,n=1;for(;e.has(a)||document.getElementById(a);)a=`${s}-${n}`,n++;t.id=a}e.add(t.id)})}buildNavigation(t){const e=document.createElement("ul");e.className="scrollpath-nav__list";const s={2:e,3:null,4:null};let a=2;t.forEach(t=>{const n=parseInt(t.tagName.charAt(1),10),l=document.createElement("li");l.className="scrollpath-nav__item",l.setAttribute("data-level",n),l.setAttribute("data-target",t.id);const i=document.createElement("a");if(i.className="scrollpath-nav__link",i.href=`#${t.id}`,i.textContent=t.textContent,l.appendChild(i),2===n)e.appendChild(l),s[2]=e,s[3]=null,s[4]=null;else if(3===n){const t=e.querySelector('.scrollpath-nav__item[data-level="2"]:last-of-type')||e.lastElementChild;if(t){let e=t.querySelector(":scope > .scrollpath-nav__list");e||(e=document.createElement("ul"),e.className="scrollpath-nav__list",t.appendChild(e)),e.appendChild(l),s[3]=e,s[4]=null}else e.appendChild(l)}else if(4===n){let t=s[3];if(t){const e=t.querySelector('.scrollpath-nav__item[data-level="3"]:last-of-type')||t.lastElementChild;if(e){let t=e.querySelector(":scope > .scrollpath-nav__list");t||(t=document.createElement("ul"),t.className="scrollpath-nav__list",e.appendChild(t)),t.appendChild(l),s[4]=t}else t.appendChild(l)}else{const t=e.lastElementChild;if(t){let e=t.querySelector(":scope > .scrollpath-nav__list");e||(e=document.createElement("ul"),e.className="scrollpath-nav__list",t.appendChild(e)),e.appendChild(l)}else e.appendChild(l)}}a=n}),this.container.appendChild(e);const n=this.container.querySelectorAll(".scrollpath-nav__item");this.navItems=[...n].map(t=>{const e=t.querySelector(".scrollpath-nav__link"),s=e.getAttribute("href").slice(1);return{listItem:t,anchor:e,target:document.getElementById(s)}}).filter(t=>t.target)}setupSvgPath(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("class","scrollpath-nav__svg"),t.setAttribute("xmlns","http://www.w3.org/2000/svg");const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("class","scrollpath-nav__path"),t.appendChild(e),this.container.appendChild(t),this.navPath=e}drawPath(){if(!this.navPath||0===this.navItems.length)return;const t=[];let e;this.navItems.forEach((s,a)=>{const n=s.anchor.offsetLeft-5,l=s.anchor.offsetTop,i=s.anchor.offsetHeight;0===a?(t.push("M",n,l,"L",n,l+i),s.pathStart=0):(e!==n&&t.push("L",e,l),t.push("L",n,l),this.navPath.setAttribute("d",t.join(" ")),s.pathStart=this.navPath.getTotalLength()||0,t.push("L",n,l+i)),e=n,this.navPath.setAttribute("d",t.join(" ")),s.pathEnd=this.navPath.getTotalLength()})}syncPath(){if(!this.navPath)return;const t=t=>t.classList.contains(this.visibleClass),e=this.navPath.getTotalLength();let s=e,a=0;if(this.navItems.forEach(e=>{t(e.listItem)&&(s=Math.min(e.pathStart,s),a=Math.max(e.pathEnd,a))}),(()=>this.container.querySelectorAll(`.${this.visibleClass}`).length>0)()&&s<a){const t=`1 ${s} ${a-s} ${e}`;this.navPath.style.setProperty("stroke-dashoffset","1"),this.navPath.style.setProperty("stroke-dasharray",t),this.navPath.style.setProperty("opacity","1")}else this.navPath.style.setProperty("opacity","0")}setupObserver(t){const e=new Map;t.forEach(t=>{e.set(t.id,t)}),this.observer=new IntersectionObserver(t=>this.handleIntersection(t),{rootMargin:"-10% 0px -70% 0px",threshold:0}),t.forEach(t=>{this.observer.observe(t)})}handleIntersection(t){t.forEach(t=>{const e=t.target.getAttribute("id"),s=this.container.querySelector(`.scrollpath-nav__item[data-target="${e}"]`);s&&(t.isIntersecting?s.classList.add(this.visibleClass):s.classList.remove(this.visibleClass))}),this.syncPath()}debounce(t,e){let s;return function(...a){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t(...a)},e)}}}window.ScrollPathNav=t}();