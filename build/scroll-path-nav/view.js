!function(){"use strict";document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".scrollpath-nav").forEach(e=>{new t(e)})});class t{constructor(t){this.container=t,this.visibleClass="scrollpath-nav__item--visible",this.navItems=[],this.navPath=null,this.observer=null,this.headings=[];const e=t.dataset.headingLevels||"h2,h3,h4";if(this.headingLevels=e.split(",").filter(Boolean),this.customSelectors=t.dataset.customSelectors||"",this.excludeSelectors=t.dataset.excludeSelectors||"",this.viewportTopMargin=parseInt(t.dataset.viewportTopMargin,10)||10,this.viewportBottomMargin=parseInt(t.dataset.viewportBottomMargin,10)||10,this.sectionBasedDetection="true"===t.dataset.sectionBasedDetection,this.pathColor=t.dataset.pathColor||"#91cb3e",this.pathWidth=parseInt(t.dataset.pathWidth,10)||3,this.pathOpacity=parseInt(t.dataset.pathOpacity,10)||100,this.pathLineStyle=t.dataset.pathLineStyle||"solid",this.childIndent=parseInt(t.dataset.childIndent,10)||20,this.pathCornerRadius=parseInt(t.dataset.pathCornerRadius,10)||0,this.fontSize=parseInt(t.dataset.fontSize,10)||14,this.lineHeight=parseFloat(t.dataset.lineHeight)||2,this.useTitleAttribute="true"===t.dataset.useTitleAttribute,this.useCustomLabel="true"===t.dataset.useCustomLabel,this.editorModeEnabled="true"===t.dataset.editorMode,this.manualEntries=[],this.editorModeEnabled&&t.dataset.manualEntries)try{this.manualEntries=JSON.parse(t.dataset.manualEntries)}catch(t){console.warn("ScrollPathNav: Failed to parse manual entries",t)}this.init()}init(){if(this.container.style.setProperty("--scrollpath-child-indent",`${this.childIndent}px`),this.container.style.setProperty("--scrollpath-font-size",`${this.fontSize}px`),this.container.style.setProperty("--scrollpath-line-height",this.lineHeight),this.editorModeEnabled&&this.manualEntries.length>0){if(this.headings=this.findHeadingsForManualEntries(),0===this.headings.length)return void(this.container.innerHTML='<p class="scrollpath-nav__empty">No matching headings found for manual entries.</p>');this.buildNavigationFromManualEntries()}else{if(this.headings=this.findHeadings(),0===this.headings.length)return void(this.container.innerHTML='<p class="scrollpath-nav__empty">No headings found on this page.</p>');this.ensureHeadingIds(this.headings),this.buildNavigation(this.headings)}this.setupSvgPath(),this.drawPath(),this.sectionBasedDetection?this.setupSectionBasedDetection():this.setupObserver(this.headings),window.addEventListener("resize",this.debounce(()=>this.drawPath(),100))}findHeadings(){const t=this.headingLevels.join(", ");let e=[];if(t&&(e=[...document.querySelectorAll(t)]),this.customSelectors&&this.customSelectors.split(",").map(t=>t.trim()).filter(Boolean).forEach(t=>{try{document.querySelectorAll(t).forEach(t=>{e.includes(t)||e.push(t)})}catch(e){console.warn(`ScrollPathNav: Invalid custom selector "${t}"`,e)}}),e.sort((t,e)=>{const s=t.compareDocumentPosition(e);return s&Node.DOCUMENT_POSITION_FOLLOWING?-1:s&Node.DOCUMENT_POSITION_PRECEDING?1:0}),e=e.filter(t=>!t.closest(".scrollpath-nav")&&!t.closest(".scrollpath-nav-editor")),this.excludeSelectors){const t=this.excludeSelectors.split(",").map(t=>t.trim()).filter(Boolean);e=e.filter(e=>!t.some(t=>{try{return e.matches(t)||e.closest(t)}catch(e){return console.warn(`ScrollPathNav: Invalid exclude selector "${t}"`,e),!1}}))}return e}findHeadingsForManualEntries(){const t=[];return this.manualEntries.forEach(e=>{let s=document.getElementById(e.id);if(!s){const t=e.label.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");s=document.getElementById(t)}if(!s){const t=document.querySelectorAll("h1, h2, h3, h4, h5, h6");for(const a of t)if(a.textContent.trim()===e.label||a.textContent.trim().includes(e.label)){s=a;break}}s&&(s.id||(s.id=e.id),t.push(s))}),t}buildNavigationFromManualEntries(){const t=document.createElement("ul");t.className="scrollpath-nav__list";const e={1:t,2:null,3:null,4:null,5:null,6:null};this.manualEntries.forEach((s,a)=>{const l=this.headings[a];if(!l)return;const i=s.level||2,n=document.createElement("li");n.className="scrollpath-nav__item",n.setAttribute("data-level",i),n.setAttribute("data-target",l.id);const o=document.createElement("a");if(o.className="scrollpath-nav__link",o.href=`#${l.id}`,o.textContent=s.label,n.appendChild(o),1===i)t.appendChild(n),e[1]=t,e[2]=null,e[3]=null,e[4]=null,e[5]=null,e[6]=null;else if(2===i){const s=t.querySelector('.scrollpath-nav__item[data-level="1"]:last-of-type');if(s){let t=s.querySelector(":scope > .scrollpath-nav__list");t||(t=document.createElement("ul"),t.className="scrollpath-nav__list",s.appendChild(t)),t.appendChild(n),e[2]=t}else t.appendChild(n),e[2]=t;e[3]=null,e[4]=null,e[5]=null,e[6]=null}else{const s=i-1;let a=e[s];if(a){const t=a.querySelector(`.scrollpath-nav__item[data-level="${s}"]:last-of-type`)||a.lastElementChild;if(t){let s=t.querySelector(":scope > .scrollpath-nav__list");s||(s=document.createElement("ul"),s.className="scrollpath-nav__list",t.appendChild(s)),s.appendChild(n),e[i]=s}else a.appendChild(n)}else t.appendChild(n);for(let t=i+1;t<=6;t++)e[t]=null}}),this.container.appendChild(t);const s=this.container.querySelectorAll(".scrollpath-nav__item");this.navItems=[...s].map(t=>{const e=t.querySelector(".scrollpath-nav__link"),s=e.getAttribute("href").slice(1);return{listItem:t,anchor:e,target:document.getElementById(s)}}).filter(t=>t.target)}ensureHeadingIds(t){const e=new Set;t.forEach((t,s)=>{if(!t.id){let s=t.textContent.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");s||(s="section");let a=s,l=1;for(;e.has(a)||document.getElementById(a);)a=`${s}-${l}`,l++;t.id=a}e.add(t.id)})}buildNavigation(t){const e=document.createElement("ul");e.className="scrollpath-nav__list";const s={1:e,2:null,3:null,4:null,5:null,6:null};let a=1;t.forEach(t=>{let l;const i=t.tagName.toLowerCase();l=/^h[1-6]$/.test(i)?parseInt(i.charAt(1),10):2;const n=document.createElement("li");n.className="scrollpath-nav__item",n.setAttribute("data-level",l),n.setAttribute("data-target",t.id);const o=document.createElement("a");o.className="scrollpath-nav__link",o.href=`#${t.id}`;let r=t.textContent;if(this.useCustomLabel&&t.dataset.scrollpathLabel?r=t.dataset.scrollpathLabel:this.useTitleAttribute&&t.getAttribute("title")&&(r=t.getAttribute("title")),o.textContent=r,n.appendChild(o),1===l)e.appendChild(n),s[1]=e,s[2]=null,s[3]=null,s[4]=null,s[5]=null,s[6]=null;else if(2===l){const t=e.querySelector('.scrollpath-nav__item[data-level="1"]:last-of-type');if(t){let e=t.querySelector(":scope > .scrollpath-nav__list");e||(e=document.createElement("ul"),e.className="scrollpath-nav__list",t.appendChild(e)),e.appendChild(n),s[2]=e}else e.appendChild(n),s[2]=e;s[3]=null,s[4]=null,s[5]=null,s[6]=null}else{const t=l-1;let a=s[t];if(a){const e=a.querySelector(`.scrollpath-nav__item[data-level="${t}"]:last-of-type`)||a.lastElementChild;if(e){let t=e.querySelector(":scope > .scrollpath-nav__list");t||(t=document.createElement("ul"),t.className="scrollpath-nav__list",e.appendChild(t)),t.appendChild(n),s[l]=t}else a.appendChild(n)}else e.appendChild(n);for(let t=l+1;t<=6;t++)s[t]=null}a=l}),this.container.appendChild(e);const l=this.container.querySelectorAll(".scrollpath-nav__item");this.navItems=[...l].map(t=>{const e=t.querySelector(".scrollpath-nav__link"),s=e.getAttribute("href").slice(1);return{listItem:t,anchor:e,target:document.getElementById(s)}}).filter(t=>t.target)}setupSvgPath(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("class","scrollpath-nav__svg"),t.setAttribute("xmlns","http://www.w3.org/2000/svg");const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("class","scrollpath-nav__path"),e.style.stroke=this.pathColor,e.style.strokeWidth=`${this.pathWidth}px`,e.style.opacity=this.pathOpacity/100,"dashed"===this.pathLineStyle?e.style.strokeDasharray="8 4":"dotted"===this.pathLineStyle&&(e.style.strokeDasharray="2 4"),t.appendChild(e),this.container.appendChild(t),this.navPath=e}drawPath(){if(!this.navPath||0===this.navItems.length)return;const t=[];let e;const s=this.pathCornerRadius;this.navItems.forEach((a,l)=>{const i=a.anchor.offsetLeft-5,n=a.anchor.offsetTop,o=a.anchor.offsetHeight;if(0===l)t.push("M",i,n,"L",i,n+o),a.pathStart=0;else{if(e!==i)if(s>0){const a=n-s;a>this.navItems[l-1].anchor.offsetTop+this.navItems[l-1].anchor.offsetHeight&&t.push("L",e,a),i>e?t.push("Q",e,n,Math.min(e+s,i),n):t.push("Q",e,n,Math.max(e-s,i),n),t.push("L",i,n)}else t.push("L",e,n),t.push("L",i,n);this.navPath.setAttribute("d",t.join(" ")),a.pathStart=this.navPath.getTotalLength()||0,t.push("L",i,n+o)}e=i,this.navPath.setAttribute("d",t.join(" ")),a.pathEnd=this.navPath.getTotalLength()})}syncPath(){if(!this.navPath)return;const t=t=>t.classList.contains(this.visibleClass),e=this.navPath.getTotalLength();let s=e,a=0;if(this.navItems.forEach(e=>{t(e.listItem)&&(s=Math.min(e.pathStart,s),a=Math.max(e.pathEnd,a))}),(()=>this.container.querySelectorAll(`.${this.visibleClass}`).length>0)()&&s<a){const t=a-s;if("solid"===this.pathLineStyle){const a=`1 ${s} ${t} ${e}`;this.navPath.style.setProperty("stroke-dashoffset","1"),this.navPath.style.setProperty("stroke-dasharray",a)}else{let l,i;"dashed"===this.pathLineStyle?(l=8,i=4):(l=2,i=4);const n=l+i;Math.ceil(t/n),this.navPath.style.setProperty("stroke-dasharray",`${l} ${i}`),this.navPath.style.setProperty("stroke-dashoffset",""+-s);const o=s/e*100,r=a/e*100;this.navPath.style.setProperty("--visible-start",`${o}%`),this.navPath.style.setProperty("--visible-end",`${r}%`),this.syncPatternedPath(s,a,l,i)}this.navPath.style.setProperty("opacity",String(this.pathOpacity/100))}else this.navPath.style.setProperty("opacity","0"),this.overlayPath&&this.overlayPath.style.setProperty("opacity","0")}syncPatternedPath(t,e,s,a){if(!this.overlayPath){const t=this.navPath.parentElement;this.overlayPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.overlayPath.setAttribute("class","scrollpath-nav__path scrollpath-nav__path--overlay"),this.overlayPath.style.stroke=this.pathColor,this.overlayPath.style.strokeWidth=`${this.pathWidth}px`,this.overlayPath.style.fill="none",this.overlayPath.style.strokeLinecap="round",t.appendChild(this.overlayPath)}this.overlayPath.setAttribute("d",this.navPath.getAttribute("d")),this.overlayPath.style.setProperty("stroke-dasharray",`${s} ${a}`);const l=this.navPath.getTotalLength(),i=e-t;this.overlayPath.style.setProperty("stroke-dashoffset",""+-t),this.overlayPath.setAttribute("pathLength",l),this.overlayPath.style.setProperty("stroke-dasharray",`${s} ${a}`),this.navPath.style.setProperty("opacity","0"),this.overlayPath.style.setProperty("opacity",String(this.pathOpacity/100));const n=l-e,o=`0 ${t} `+`${s} ${a} `.repeat(Math.ceil(i/(s+a)))+`0 ${n+l}`;this.overlayPath.style.setProperty("stroke-dasharray",o),this.overlayPath.style.setProperty("stroke-dashoffset","0")}setupSectionBasedDetection(){this.sectionBounds=this.calculateSectionBounds();let t=!1;this.handleSectionScroll=()=>{t||(requestAnimationFrame(()=>{this.updateSectionVisibility(),t=!1}),t=!0)},window.addEventListener("scroll",this.handleSectionScroll,{passive:!0}),this.updateSectionVisibility()}calculateSectionBounds(){const t=[],e=this.headings;for(let s=0;s<e.length;s++){const a=e[s],l=e[s+1],i=a.getBoundingClientRect().top+window.scrollY;let n;n=l?l.getBoundingClientRect().top+window.scrollY:document.documentElement.scrollHeight,t.push({id:a.id,start:i,end:n})}return t}updateSectionVisibility(){this.sectionBounds=this.calculateSectionBounds();const t=window.scrollY,e=window.scrollY+window.innerHeight;this.navItems.forEach(t=>{t.listItem.classList.remove(this.visibleClass)}),this.sectionBounds.forEach(s=>{if(s.start<e&&s.end>t){const t=this.container.querySelector(`.scrollpath-nav__item[data-target="${s.id}"]`);t&&t.classList.add(this.visibleClass)}}),this.syncPath()}setupObserver(t){const e=new Map;t.forEach(t=>{e.set(t.id,t)});const s=`-${this.viewportTopMargin}% 0px -${this.viewportBottomMargin}% 0px`;this.observer=new IntersectionObserver(t=>this.handleIntersection(t),{rootMargin:s,threshold:0}),t.forEach(t=>{this.observer.observe(t)})}handleIntersection(t){t.forEach(t=>{const e=t.target.getAttribute("id"),s=this.container.querySelector(`.scrollpath-nav__item[data-target="${e}"]`);s&&(t.isIntersecting?s.classList.add(this.visibleClass):s.classList.remove(this.visibleClass))}),this.syncPath()}debounce(t,e){let s;return function(...a){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t(...a)},e)}}}window.ScrollPathNav=t}();