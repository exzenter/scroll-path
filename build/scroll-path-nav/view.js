!function(){"use strict";document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".scrollpath-nav").forEach(e=>{new t(e)})});class t{constructor(t){this.container=t,this.visibleClass="scrollpath-nav__item--visible",this.navItems=[],this.navPath=null,this.observer=null;const e=t.dataset.headingLevels||"h2,h3,h4";this.headingLevels=e.split(",").filter(Boolean),this.customSelectors=t.dataset.customSelectors||"",this.init()}init(){const t=this.findHeadings();0!==t.length?(this.ensureHeadingIds(t),this.buildNavigation(t),this.setupSvgPath(),this.drawPath(),this.setupObserver(t),window.addEventListener("resize",this.debounce(()=>this.drawPath(),100))):this.container.innerHTML='<p class="scrollpath-nav__empty">No headings found on this page.</p>'}findHeadings(){const t=this.headingLevels.join(", ");let e=[];return t&&(e=[...document.querySelectorAll(t)]),this.customSelectors&&this.customSelectors.split(",").map(t=>t.trim()).filter(Boolean).forEach(t=>{try{document.querySelectorAll(t).forEach(t=>{e.includes(t)||e.push(t)})}catch(e){console.warn(`ScrollPathNav: Invalid custom selector "${t}"`,e)}}),e.sort((t,e)=>{const s=t.compareDocumentPosition(e);return s&Node.DOCUMENT_POSITION_FOLLOWING?-1:s&Node.DOCUMENT_POSITION_PRECEDING?1:0}),e.filter(t=>!t.closest(".scrollpath-nav")&&!t.closest(".scrollpath-nav-editor"))}ensureHeadingIds(t){const e=new Set;t.forEach((t,s)=>{if(!t.id){let s=t.textContent.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");s||(s="section");let a=s,l=1;for(;e.has(a)||document.getElementById(a);)a=`${s}-${l}`,l++;t.id=a}e.add(t.id)})}buildNavigation(t){const e=document.createElement("ul");e.className="scrollpath-nav__list";const s={1:e,2:null,3:null,4:null,5:null,6:null};let a=1;t.forEach(t=>{let l;const n=t.tagName.toLowerCase();l=/^h[1-6]$/.test(n)?parseInt(n.charAt(1),10):2;const i=document.createElement("li");i.className="scrollpath-nav__item",i.setAttribute("data-level",l),i.setAttribute("data-target",t.id);const o=document.createElement("a");if(o.className="scrollpath-nav__link",o.href=`#${t.id}`,o.textContent=t.textContent,i.appendChild(o),1===l)e.appendChild(i),s[1]=e,s[2]=null,s[3]=null,s[4]=null,s[5]=null,s[6]=null;else if(2===l){const t=e.querySelector('.scrollpath-nav__item[data-level="1"]:last-of-type');if(t){let e=t.querySelector(":scope > .scrollpath-nav__list");e||(e=document.createElement("ul"),e.className="scrollpath-nav__list",t.appendChild(e)),e.appendChild(i),s[2]=e}else e.appendChild(i),s[2]=e;s[3]=null,s[4]=null,s[5]=null,s[6]=null}else{const t=l-1;let a=s[t];if(a){const e=a.querySelector(`.scrollpath-nav__item[data-level="${t}"]:last-of-type`)||a.lastElementChild;if(e){let t=e.querySelector(":scope > .scrollpath-nav__list");t||(t=document.createElement("ul"),t.className="scrollpath-nav__list",e.appendChild(t)),t.appendChild(i),s[l]=t}else a.appendChild(i)}else e.appendChild(i);for(let t=l+1;t<=6;t++)s[t]=null}a=l}),this.container.appendChild(e);const l=this.container.querySelectorAll(".scrollpath-nav__item");this.navItems=[...l].map(t=>{const e=t.querySelector(".scrollpath-nav__link"),s=e.getAttribute("href").slice(1);return{listItem:t,anchor:e,target:document.getElementById(s)}}).filter(t=>t.target)}setupSvgPath(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("class","scrollpath-nav__svg"),t.setAttribute("xmlns","http://www.w3.org/2000/svg");const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("class","scrollpath-nav__path"),t.appendChild(e),this.container.appendChild(t),this.navPath=e}drawPath(){if(!this.navPath||0===this.navItems.length)return;const t=[];let e;this.navItems.forEach((s,a)=>{const l=s.anchor.offsetLeft-5,n=s.anchor.offsetTop,i=s.anchor.offsetHeight;0===a?(t.push("M",l,n,"L",l,n+i),s.pathStart=0):(e!==l&&t.push("L",e,n),t.push("L",l,n),this.navPath.setAttribute("d",t.join(" ")),s.pathStart=this.navPath.getTotalLength()||0,t.push("L",l,n+i)),e=l,this.navPath.setAttribute("d",t.join(" ")),s.pathEnd=this.navPath.getTotalLength()})}syncPath(){if(!this.navPath)return;const t=t=>t.classList.contains(this.visibleClass),e=this.navPath.getTotalLength();let s=e,a=0;if(this.navItems.forEach(e=>{t(e.listItem)&&(s=Math.min(e.pathStart,s),a=Math.max(e.pathEnd,a))}),(()=>this.container.querySelectorAll(`.${this.visibleClass}`).length>0)()&&s<a){const t=`1 ${s} ${a-s} ${e}`;this.navPath.style.setProperty("stroke-dashoffset","1"),this.navPath.style.setProperty("stroke-dasharray",t),this.navPath.style.setProperty("opacity","1")}else this.navPath.style.setProperty("opacity","0")}setupObserver(t){const e=new Map;t.forEach(t=>{e.set(t.id,t)}),this.observer=new IntersectionObserver(t=>this.handleIntersection(t),{rootMargin:"-10% 0px -70% 0px",threshold:0}),t.forEach(t=>{this.observer.observe(t)})}handleIntersection(t){t.forEach(t=>{const e=t.target.getAttribute("id"),s=this.container.querySelector(`.scrollpath-nav__item[data-target="${e}"]`);s&&(t.isIntersecting?s.classList.add(this.visibleClass):s.classList.remove(this.visibleClass))}),this.syncPath()}debounce(t,e){let s;return function(...a){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t(...a)},e)}}}window.ScrollPathNav=t}();